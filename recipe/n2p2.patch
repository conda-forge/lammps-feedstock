From 52279dc8a0a9f755e3a004176f6d4670d24686b5 Mon Sep 17 00:00:00 2001
From: Alin Marin Elena <alin@elena.space>
Date: Mon, 13 Jul 2020 18:45:33 +0100
Subject: [PATCH] n2p2 support

---
 cmake/Modules/FindN2P2.cmake          | 40 +++++++++++++++++++++++++++
 cmake/Modules/Packages/USER-NNP.cmake |  3 ++
 2 files changed, 43 insertions(+), 0 deletions(-)
 create mode 100644 cmake/Modules/FindN2P2.cmake
 create mode 100644 cmake/Modules/Packages/USER-NNP.cmake

diff --git a/cmake/Modules/FindN2P2.cmake b/cmake/Modules/FindN2P2.cmake
new file mode 100644
index 0000000000..c4fc1beeb
--- /dev/null
+++ b/cmake/Modules/FindN2P2.cmake
@@ -0,0 +1,40 @@
+# - Find N2P2
+# Find the native N2P2 libraries.
+#
+#  N2P2_LIBRARIES    - List of libraries of the N2P2 package
+#  N2P2_FOUND        - True if N2P2 library was found.
+#
+
+# find_path(N2P2_INCLUDE_DIR InterfaceLammps.h PATHS ENV N2P2ROOT PATH_SUFFIXES include )
+find_library(NNP_LIBRARY NAMES nnp)
+find_library(NNPIF_LIBRARY NAMES nnpif)
+
+include(FindPackageHandleStandardArgs)
+# handle the QUIETLY and REQUIRED arguments and set QUIP_FOUND to TRUE
+# if all listed variables are TRUE
+
+find_package_handle_standard_args(N2P2 DEFAULT_MSG
+  NNP_LIBRARY
+  NNPIF_LIBRARY
+  N2P2_INCLUDE_DIR)
+# Copy the results to the output variables and target.
+if(N2P2_FOUND)
+  set(N2P2_LIBRARIES ${NNP_LIBRARY} ${NNPIF_LIBRARY})
+  # set(N2P2_INCLUDE_DIRS ${N2P2_INCLUDE_DIR})
+
+  if(NOT TARGET N2P2::NNP)
+    add_library(N2P2::NNP1 UNKNOWN IMPORTED)
+    set_target_properties(N2P2::NNP1 PROPERTIES
+      IMPORTED_LOCATION "${NNP_LIBRARY}"
+      INTERFACE_INCLUDE_DIRECTORIES "${N2P2_INCLUDE_DIR}")
+    add_library(N2P2::NNPIF UNKNOWN IMPORTED)
+    set_target_properties(N2P2::NNPIF PROPERTIES
+      IMPORTED_LOCATION "${NNPIF_LIBRARY}"
+      INTERFACE_INCLUDE_DIRECTORIES "${N2P2_INCLUDE_DIR}")
+   add_library(N2P2::NNP INTERFACE IMPORTED)
+   set_property(TARGET N2P2::NNP PROPERTY
+      INTERFACE_LINK_LIBRARIES N2P2::NNP1 N2P2::NNPIF)
+  endif()
+endif()
+
+mark_as_advanced(NNP_LIBRARY NNPIF_LIBRARY)
diff --git a/cmake/Modules/Packages/USER-NNP.cmake b/cmake/Modules/Packages/USER-NNP.cmake
new file mode 100644
index 0000000000..a9f073f21
--- /dev/null
+++ b/cmake/Modules/Packages/USER-NNP.cmake
@@ -0,0 +1,3 @@
+find_package(N2P2 REQUIRED)
+target_link_libraries(lammps PRIVATE N2P2::NNP)
+
