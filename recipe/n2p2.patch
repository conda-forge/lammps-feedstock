From f7ebd090cad2fc065d09396af0e3d70012982b29 Mon Sep 17 00:00:00 2001
From: Jan Janssen <jan-janssen@users.noreply.github.com>
Date: Sun, 14 Feb 2021 21:41:01 +0100
Subject: [PATCH] NNP (#1)

---
 cmake/Modules/FindN2P2.cmake          | 40 +++++++++++++++++++++++++++
 cmake/Modules/Packages/USER-NNP.cmake |  2 ++
 2 files changed, 42 insertions(+)
 create mode 100644 cmake/Modules/FindN2P2.cmake
 create mode 100644 cmake/Modules/Packages/USER-NNP.cmake

diff --git a/cmake/Modules/FindN2P2.cmake b/cmake/Modules/FindN2P2.cmake
new file mode 100644
index 0000000000..c4fc1beeb6
--- /dev/null
+++ b/cmake/Modules/FindN2P2.cmake
@@ -0,0 +1,40 @@
+# - Find N2P2
+# Find the native N2P2 libraries.
+#
+#  N2P2_LIBRARIES    - List of libraries of the N2P2 package
+#  N2P2_FOUND        - True if N2P2 library was found.
+#
+
+find_path(N2P2_INCLUDE_DIR InterfaceLammps.h PATHS ENV N2P2ROOT PATH_SUFFIXES include )
+find_library(NNP_LIBRARY NAMES nnp PATHS ENV N2P2ROOT PATH_SUFFIXES lib)
+find_library(NNPIF_LIBRARY NAMES nnpif PATHS ENV N2P2ROOT PATH_SUFFIXES lib)
+
+include(FindPackageHandleStandardArgs)
+# handle the QUIETLY and REQUIRED arguments and set QUIP_FOUND to TRUE
+# if all listed variables are TRUE
+
+find_package_handle_standard_args(N2P2 DEFAULT_MSG
+  NNP_LIBRARY
+  NNPIF_LIBRARY
+  N2P2_INCLUDE_DIR)
+# Copy the results to the output variables and target.
+if(N2P2_FOUND)
+  set(N2P2_LIBRARIES ${NNP_LIBRARY} ${NNPIF_LIBRARY})
+  set(N2P2_INCLUDE_DIRS ${N2P2_INCLUDE_DIR})
+
+  if(NOT TARGET N2P2::NNP)
+    add_library(N2P2::NNP1 UNKNOWN IMPORTED)
+    set_target_properties(N2P2::NNP1 PROPERTIES
+      IMPORTED_LOCATION "${NNP_LIBRARY}"
+      INTERFACE_INCLUDE_DIRECTORIES "${N2P2_INCLUDE_DIR}")
+    add_library(N2P2::NNPIF UNKNOWN IMPORTED)
+    set_target_properties(N2P2::NNPIF PROPERTIES
+      IMPORTED_LOCATION "${NNPIF_LIBRARY}"
+      INTERFACE_INCLUDE_DIRECTORIES "${N2P2_INCLUDE_DIR}")
+   add_library(N2P2::NNP INTERFACE IMPORTED)
+   set_property(TARGET N2P2::NNP PROPERTY
+      INTERFACE_LINK_LIBRARIES N2P2::NNP1 N2P2::NNPIF)
+  endif()
+endif()
+
+mark_as_advanced(NNP_LIBRARY N2P2_INCLUDE_DIR NNPIF_LIBRARY)
diff --git a/cmake/Modules/Packages/USER-NNP.cmake b/cmake/Modules/Packages/USER-NNP.cmake
new file mode 100644
index 0000000000..70695a3ac4
--- /dev/null
+++ b/cmake/Modules/Packages/USER-NNP.cmake
@@ -0,0 +1,2 @@
+find_package(N2P2 REQUIRED)
+target_link_libraries(lammps PRIVATE N2P2::NNP)
